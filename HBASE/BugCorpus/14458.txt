asyncrpccli createrpcchannel check remov dead channel creat server notic issu test master branch distribut mode reproduct step 1 write data hbase ltt 2 ltt write execut grace stop sh restart reload rs 3 wait script start reload region restart server moment ltt stop write eventu fail dig notic ltt work correctli singl connect regionserv lsof singl connect 27109 ltt pid java 27109 hbase 143u 210579579 0t0 tcp hnode1 40423 gt hnode5 16020 establish hnode5 server restart script start reload region server ltt start creat thousand tcp connect server java 27109 hbase 623u 210674415 0t0 tcp hnode1 52948 gt hnode5 16020 establish java 27109 hbase 624u 210674416 0t0 tcp hnode1 52949 gt hnode5 16020 establish java 27109 hbase 625u 210674417 0t0 tcp hnode1 52950 gt hnode5 16020 establish java 27109 hbase 627u 210674419 0t0 tcp hnode1 52952 gt hnode5 16020 establish java 27109 hbase 628u 210674420 0t0 tcp hnode1 52953 gt hnode5 16020 establish java 27109 hbase 633u 210674425 0t0 tcp hnode1 52958 gt hnode5 16020 establish base addit log debug asyncrpccli detect regionserv restart region move write read request server sort heart bit mechan implement dead asyncrpcchannel stai poolmap lt integ asyncrpcchannel gt connect ltt detect region move back hnode5 reconnect hnode5 lead issu resolv issu ad asyncrpccli createrpcchannel synchron connect close throw stoppedrpcclientexcept rpcchannel connect hashcod rpcchannel null amp amp rpcchannel isal log debug remov dead channel rpcchannel address tostr connect remov hashcod rpcchannel null rpcchannel isal rpcchannel asyncrpcchannel bootstrap ticket servicenam locat connect put hashcod rpcchannel attach patch test